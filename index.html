<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
    <link href='https://fonts.googleapis.com/css?family=Indie+Flower' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Indie+Flower|Josefin+Sans' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Indie+Flower|Josefin+Sans|Fira+Sans' rel='stylesheet' type='text/css'>
  </head>
  <body>
  
  <h1>T W I T T L E R</h1>
  <h3> Your Social Feed:</h3>
  <div id="feed" class="row"><div id="username" class="col-2"></div><div id="msg" class="col-6"></div><div id="dates" class="col-4"></div></div>
  <button>Click to Refresh</button>
  <div id="tl-heading"></div>
  <div id="userTimeline"></div>


    <script>
      $(document).ready(function(){
      
      var $username = $('#username'),  $msg = $('#msg'), $dates = $('#dates'), $userTimeline = $('#userTimeline');
         

      
      var refresh = function (){
      
          $username.html(''), $msg.html(''), $dates.html('');
          var index = streams.home.length - 1;
            while(index >= 0){


              var tweet = streams.home[index];
              var $tweetName = $('<div></div>');
              $tweetName.text(tweet.user);    
              $tweetName.appendTo($username);
           
              var $msgtext = $('<div></div>');
              $msgtext.text(': ' + tweet.message);    
              $msgtext.appendTo($msg);
  //              var today = new Date();
  //            var shortDate = Date().toString().split("2015")[0] + today.getFullYear();
              if (!tweet.date){
                tweet.date = Date();
              };

              var $datetext = $('<div></div>');
              $datetext.text('--- ' + tweet.date);    
              $datetext.appendTo($dates);
            index -= 1;
          }
         $('button').on('click', refresh);
       
      };



        $('#username').on('click', 'div', 
        showTimeline);
      

        function showTimeline (){
          $('#tl-heading').text("SHOWING ALL MESSAGES FOR USER: @" + $(this).text());
          $userTimeline.text('');
          
          $('#userTimeline').slideDown();

          var tweet = streams.users[$(this).text()];
          var index = tweet.length - 1;
            while(index >= 0){
              //var today = new Date();
              //var shortDate = Date().toString().split("2015")[0] + today.getFullYear();
              var $msgtext = $('<div></div>');
              var timestamp = "not found";
              var feedIndex = streams.home.length - 1;
            
            while(feedIndex >= 0){
              var feedTweet = streams.home[feedIndex]; 
               if  (feedTweet.message === tweet[index].message) {
                if (!feedTweet.date){
                  feedTweet.date = Date();
                };
                  timestamp = feedTweet.date;
                  break;
                 }
                 feedIndex -= 1;
              }
              $msgtext.text(tweet[index].message + " ----- " + timestamp);    
              $msgtext.appendTo($userTimeline);

          index -= 1;
          }

        }


      refresh();

       });






    </script>
  </body>
</html>
